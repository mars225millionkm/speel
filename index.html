<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>sleep¬∑track ¬∑ mobile fit ¬∑ 8h goal</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        body {
            background: #f1f5f9;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 12px;
        }
        .card {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 32px;
            box-shadow: 0 20px 35px -8px rgba(0,0,0,0.15);
            padding: 1.5rem 1.2rem 2rem;
            margin: 0 auto;
        }
        h1 {
            font-size: 1.9rem;
            font-weight: 500;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            color: #0a1120;
            margin-bottom: 0.25rem;
        }
        h1 span {
            background: #e6f0ff;
            font-size: 0.8rem;
            font-weight: 400;
            padding: 0.2rem 1rem;
            border-radius: 40px;
            color: #1e4a7a;
        }
        .sub {
            color: #2c3e5c;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            border-left: 4px solid #90b4f0;
            padding-left: 1rem;
        }
        /* entry panel ‚Äì stacked on mobile */
        .entry-panel {
            background: #f8fafd;
            border-radius: 1.8rem;
            padding: 1.5rem 1.2rem;
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            border: 1px solid #dde7f0;
        }
        .field-group {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        .field-group label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            font-weight: 600;
            color: #2c4b74;
            margin-bottom: 0.25rem;
        }
        .field-group input {
            background: white;
            border: 1px solid #bdcde0;
            border-radius: 60px;
            padding: 0.8rem 1.2rem;
            font-size: 1rem;
            width: 100%;
            outline: none;
            transition: 0.15s;
            -webkit-appearance: none;
            appearance: none;
        }
        .field-group input:focus {
            border-color: #3e74c0;
            box-shadow: 0 0 0 3px rgba(62,116,192,0.15);
        }
        .field-group input[readonly] {
            background-color: #ecf2f9;
            color: #0f2e4a;
            font-weight: 500;
            border-color: #b3c9e5;
            cursor: default;
        }
        .inline-hint {
            font-size: 0.8rem;
            color: #4b5e7a;
            margin-top: 0.25rem;
            padding-left: 0.5rem;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            align-items: center;
            margin-top: 0.3rem;
        }
        .btn {
            background: #1f3a6b;
            color: white;
            border: none;
            font-weight: 500;
            padding: 0.8rem 1.8rem;
            border-radius: 60px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.15s;
            border: 1px solid #1f3a6b;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            flex: 1 1 auto;
            white-space: nowrap;
        }
        .btn-outline {
            background: white;
            color: #1f3a6b;
            border: 1px solid #a7c0e2;
        }
        .btn-outline:hover, .btn:hover {
            opacity: 0.85;
        }
        /* dashboard cards side by side on mobile (still grid, but auto) */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            margin-bottom: 2rem;
        }
        .stat-box {
            background: #ffffff;
            border-radius: 1.5rem;
            padding: 1.2rem 1rem;
            box-shadow: 0 4px 12px rgba(0,20,40,0.02);
            border: 1px solid #dde3ec;
        }
        .stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #546e8a;
            text-transform: uppercase;
            letter-spacing: 0.2px;
            margin-bottom: 0.2rem;
            word-break: break-word;
        }
        .stat-value {
            font-size: 2.1rem;
            font-weight: 400;
            line-height: 1.1;
            color: #0b1b33;
            word-break: break-word;
        }
        .stat-value small {
            font-size: 1rem;
            font-weight: 300;
            color: #5f7698;
            margin-left: 0.2rem;
        }
        .stat-note {
            color: #335b8a;
            font-size: 0.75rem;
            margin-top: 0.4rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0 0.8rem;
            flex-wrap: wrap;
            gap: 0.4rem;
        }
        .history-header h3 {
            font-weight: 500;
            color: #14273e;
            font-size: 1.2rem;
        }
        .max-highlight {
            background: #f2eefb;
            border-radius: 50px;
            padding: 0.3rem 1rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: #1f3857;
        }
        .history-list {
            background: #f9fcff;
            border-radius: 1.4rem;
            border: 1px solid #d9e4f0;
            overflow: hidden;
        }
        /* mobile friendly history row ‚Äî stacked info */
        .history-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.2rem;
            border-bottom: 1px solid #dce6f0;
            background: white;
            gap: 0.5rem;
        }
        .history-row:last-child {
            border-bottom: none;
        }
        .history-index {
            color: #2a4e77;
            font-weight: 500;
            font-size: 0.9rem;
            min-width: 55px;
        }
        .history-data {
            display: flex;
            gap: 0.8rem;
            font-weight: 500;
            flex-wrap: wrap;
        }
        .history-data span {
            background: #eaf1fb;
            padding: 0.3rem 0.9rem;
            border-radius: 30px;
            font-size: 0.85rem;
            color: #113355;
            white-space: nowrap;
        }
        .history-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        .edit-btn, .delete-btn {
            background: none;
            border: none;
            font-size: 0.8rem;
            padding: 0.4rem 1rem;
            border-radius: 40px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.1s;
            white-space: nowrap;
        }
        .edit-btn {
            background: #e2ebf6;
            color: #1b3f64;
        }
        .edit-btn:active {
            background: #c7daf2;
        }
        .delete-btn {
            background: #fee9e7;
            color: #a03f33;
        }
        .delete-btn:active {
            background: #fccac5;
        }
        .empty-message {
            padding: 2rem;
            text-align: center;
            color: #6d8bb0;
            font-style: italic;
            font-size: 0.95rem;
        }
        .footer-note {
            margin-top: 1.2rem;
            font-size: 0.8rem;
            color: #567196;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.3rem;
        }
        @media (max-width: 420px) {
            .history-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .history-actions {
                margin-left: 0;
                width: 100%;
                justify-content: flex-start;
            }
            .stat-value {
                font-size: 1.8rem;
            }
            .btn {
                padding: 0.7rem 1rem;
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
<div class="card">
    <h1>üò¥ sleep meter <span>8h = 100%</span></h1>
    <div class="sub">enter minutes ‚Üí % auto ¬∑ no dates</div>

    <!-- ENTRY FORM (mobile stacked, auto %) -->
    <div class="entry-panel" id="entryPanel">
        <div class="field-group">
            <label>‚è±Ô∏è sleep minutes</label>
            <input type="number" id="minutesInput" placeholder="e.g. 420" min="0" step="1" value="480" inputmode="numeric">
            <div class="inline-hint">8h = 480 min = 100%</div>
        </div>
        <div class="field-group">
            <label>üìä % (auto)</label>
            <input type="number" id="percentInput" readonly step="any" value="100.00">
            <div class="inline-hint">updates as you type</div>
        </div>
        <div class="btn-group">
            <button class="btn" id="addBtn">‚ûï add entry</button>
            <button class="btn-outline btn" id="cancelEdit" style="display: none;">‚úñ cancel</button>
        </div>
    </div>

    <!-- DASHBOARD (exactly as described: avg, highest + minutes) -->
    <div class="dashboard">
        <div class="stat-box">
            <div class="stat-label">month avg sleep %</div>
            <div class="stat-value" id="avgPercent">‚Äî<small>%</small></div>
            <div class="stat-note">based on daily %</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">‚≠ê highest recorded</div>
            <div class="stat-value" id="highestPercent">‚Äî<small>%</small></div>
            <div class="stat-note" id="highestHours">‚Äî minutes</div>
        </div>
    </div>

    <!-- HISTORY (day by day, fully editable) -->
    <div class="history-header">
        <h3>üìã sleep history</h3>
        <span class="max-highlight" id="totalEntries">2 days</span>
    </div>
    <div id="historyContainer" class="history-list">
        <!-- filled by js -->
    </div>

    <div class="footer-note">
        <span>‚úÖ edit any entry ‚Üí dashboard updates</span>
        <span>‚ö° % always matches minutes (8h base)</span>
    </div>
</div>

<script>
    (function() {
        const IDEAL_MINUTES = 480;

        let sleepEntries = [];
        let editIndex = null;

        // DOM
        const minutesInput = document.getElementById('minutesInput');
        const percentInput = document.getElementById('percentInput');
        const addBtn = document.getElementById('addBtn');
        const cancelEditBtn = document.getElementById('cancelEdit');
        const historyContainer = document.getElementById('historyContainer');
        const avgPercentSpan = document.getElementById('avgPercent');
        const highestPercentSpan = document.getElementById('highestPercent');
        const highestHoursSpan = document.getElementById('highestHours');
        const totalEntriesSpan = document.getElementById('totalEntries');

        // auto-update percent when minutes change
        function updatePercentFromMinutes() {
            const mins = parseFloat(minutesInput.value);
            if (!isNaN(mins) && mins >= 0) {
                const computed = (mins / IDEAL_MINUTES) * 100;
                percentInput.value = computed.toFixed(2);
            } else {
                percentInput.value = '';
            }
        }
        minutesInput.addEventListener('input', updatePercentFromMinutes);
        minutesInput.addEventListener('blur', function() {
            let mins = parseFloat(minutesInput.value);
            if (isNaN(mins) || mins < 0) {
                minutesInput.value = 0;
                updatePercentFromMinutes();
            }
        });

        // localStorage
        function saveToLocal() {
            localStorage.setItem('sleepEntries', JSON.stringify(sleepEntries));
        }
        function loadFromLocal() {
            const stored = localStorage.getItem('sleepEntries');
            if (stored) {
                try {
                    sleepEntries = JSON.parse(stored);
                } catch (e) {
                    sleepEntries = [];
                }
            } else {
                // demo entries exactly as in your screenshot description
                sleepEntries = [
                    { minutes: 240, percent: 50.00 },
                    { minutes: 480, percent: 100.00 },
                ];
            }
        }

        // render history (mobile friendly)
        function renderHistory() {
            if (sleepEntries.length === 0) {
                historyContainer.innerHTML = `<div class="empty-message">no entries yet ‚Äì add your first sleep</div>`;
                return;
            }

            let html = '';
            sleepEntries.forEach((entry, idx) => {
                const mins = entry.minutes;
                const perc = entry.percent;
                const percDisplay = Number(perc).toFixed(1).replace(/\.0$/, '');
                const minsDisplay = mins + ' min';

                html += `
                    <div class="history-row" data-index="${idx}">
                        <div class="history-index">day ${idx+1}</div>
                        <div class="history-data">
                            <span>${minsDisplay}</span>
                            <span>${percDisplay}%</span>
                        </div>
                        <div class="history-actions">
                            <button class="edit-btn" data-index="${idx}">edit</button>
                            <button class="delete-btn" data-index="${idx}">delete</button>
                        </div>
                    </div>
                `;
            });
            historyContainer.innerHTML = html;

            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = e.target.getAttribute('data-index');
                    if (idx !== null) startEdit(parseInt(idx));
                });
            });
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = e.target.getAttribute('data-index');
                    if (idx !== null) deleteEntry(parseInt(idx));
                });
            });
        }

        // update dashboard
        function updateStats() {
            const n = sleepEntries.length;
            if (n === 0) {
                avgPercentSpan.innerText = '‚Äî';
                highestPercentSpan.innerText = '‚Äî';
                highestHoursSpan.innerText = 'no entries';
                totalEntriesSpan.innerText = '0 days';
                return;
            }

            let sumPerc = 0;
            let maxPerc = -Infinity;
            let maxMinutes = 0;

            sleepEntries.forEach(entry => {
                const p = entry.percent;
                sumPerc += p;
                if (p > maxPerc) {
                    maxPerc = p;
                    maxMinutes = entry.minutes;
                }
            });

            const avg = sumPerc / n;
            avgPercentSpan.innerText = avg.toFixed(1).replace(/\.0$/, '') + '%';
            highestPercentSpan.innerText = maxPerc.toFixed(1).replace(/\.0$/, '') + '%';
            highestHoursSpan.innerText = maxMinutes + ' minutes (at highest %)';
            totalEntriesSpan.innerText = n + (n === 1 ? ' day' : ' days');
        }

        // add / update entry
        function addEntry() {
            const mins = parseFloat(minutesInput.value);
            const perc = parseFloat(percentInput.value);

            if (isNaN(mins) || mins < 0 || isNaN(perc) || perc < 0) {
                alert('please enter valid minutes (>=0)');
                return;
            }

            const newEntry = { minutes: mins, percent: perc };

            if (editIndex !== null) {
                sleepEntries[editIndex] = newEntry;
                editIndex = null;
                addBtn.innerText = '‚ûï add entry';
                cancelEditBtn.style.display = 'none';
            } else {
                sleepEntries.push(newEntry);
            }

            saveToLocal();
            renderHistory();
            updateStats();

            // reset to default 480
            minutesInput.value = '480';
            updatePercentFromMinutes();
        }

        function startEdit(index) {
            if (index < 0 || index >= sleepEntries.length) return;
            const entry = sleepEntries[index];
            minutesInput.value = entry.minutes;
            updatePercentFromMinutes();   // percent auto-sync
            editIndex = index;
            addBtn.innerText = '‚úèÔ∏è update entry';
            cancelEditBtn.style.display = 'inline-block';
        }

        function cancelEdit() {
            editIndex = null;
            minutesInput.value = '480';
            updatePercentFromMinutes();
            addBtn.innerText = '‚ûï add entry';
            cancelEditBtn.style.display = 'none';
        }

        function deleteEntry(index) {
            if (index < 0 || index >= sleepEntries.length) return;
            sleepEntries.splice(index, 1);

            if (editIndex === index) {
                cancelEdit();
            } else if (editIndex !== null && editIndex > index) {
                editIndex -= 1;
            }

            saveToLocal();
            renderHistory();
            updateStats();

            if (sleepEntries.length === 0 && editIndex !== null) cancelEdit();
        }

        // init
        loadFromLocal();
        renderHistory();
        updateStats();
        updatePercentFromMinutes();

        addBtn.addEventListener('click', addEntry);
        cancelEditBtn.addEventListener('click', cancelEdit);

        window.addEventListener('beforeunload', saveToLocal);
    })();
</script>
</body>
</html>
